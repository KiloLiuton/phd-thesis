\chapter{Mean field theory for small world networks}

The previous chapter focused mainly on simulation results for ring-lattices and small-world networks. In this chapter we develop a mean
field (MF) theory for the WCM dynamics on a system of $N$ oscillators coupled according to small world networks as described by the
Watts Strogatz algorithm in section~\ref{smallworld}. We start by re-stating the dynamics rules and proceed to take the continuous
limit.

An oscillator is described by its discrete phase state, which can be imagined as a clock hand which abruptly jumps from noon to 4pm
then 8pm and back to noon. These jumps happen randomly but with a well defined average rate over time. When two oscillators interact,
this average rate of transition may change depending on the relative phase between the two units.

To describe the phase value and interactions, we adopt a convention: oscillators are arranged in a circle and numbered from 1 to $N$.
The superscripts then refer to the oscillators index. Subscripts denote a phase state from 1 to 3. Given a graph where nodes represent
phase oscillators labeled by $x$, the unit at position $x$ is described by its phase value

\begin{align}
    \phi^x = 2\pi (j-1)/3 \\
    j \in \{1,2,3\} \notag
\end{align}

\noindent where $j$ is the state of unit $x$. Since transitions can only occur in one direction, for a given unit at $x$, the
stochastic rate of transition from state $j$ to $j+1$ is written just as $\gamma^x_j$, and is given by the Arrhenius form:

\begin{equation}
    \gamma^x_j = \omega^x\exp\left[ a\frac{n^x_{j+1} - n^x_j}{n^x} \right] \qquad x=1,\dots, N
    \label{rate}
\end{equation}

\noindent where $\omega^x$ is its natural (uncoupled) frequency, $n^x_j$ is the count of how many of its neighbors are in state $j$,
and $n^x$ is its total number of neighbors.

Let the probability of finding the unit at $x$ in state $j$ be denoted by $p^x_j$. Since there are only three possible states we have
the restrictions $p^x_1+p^x_2+p^x_3=1$ for all $x$. The rate of change of the probabilities can be written in terms of the transition
rates $\gamma^x_j$, giving us $2N$ equations of motion:

\begin{align}
    \ddt{p}^x_1 &= \gamma^x_3(1 - p^x_1 - p^x_2) - \gamma^x_1 p^x_1 & \notag\\
    \ddt{p}^x_2 &= \gamma^x_1p^x_1 - \gamma^x_2 p^x_2 &x=1,\dots,N
    \label{eqmotion}
\end{align}

\noindent The first terms in the RHS of (\ref{eqmotion}) represent the fluxes of probability from oscillators in the previous state,
which can advance one phase state and increase the populations of oscillators in states 1 and 2 respectively. The second (negative)
terms represent the fluxes generated by the oscillator leaving the considered state, and thus reducing that states population.  This
dynamics occurs on small-world networks, which are generated following the Watts-Strogatz algorithm starting with a ring lattice.

A ring lattice is constructed by arranging $N$ oscillators in a circle, and then for each unit, add $K$ clock-wise connections to the
next $K$ units in the circle, resulting in a circular shape with $NK$ total edges. The result of this process for $N=12$ and $K=2$ can
be seen in figure~\ref{fig:ring} in chapter~\ref{chap:article}.

To generate a small-world network, the rewiring procedure considers each existing edge once, and with a probability $p$ it changes the
clockwise vertex of this edge by a randomly selected node in the network. If the randomly selected node would create an already
existing edge or a self-connection, no action is performed.

\section{Mean field}

By defining the fractions in the exponent of equation~(\ref{rate}) at a fixed time $t$ as

\begin{equation}
    \nu^x_j(t) \equiv \frac{n^x_j(t)}{n^x(t)}
\end{equation}

\noindent the transition rates are now written as $\gamma^x_j(t) = g^x\exp\left[ a(\nu^x_{j+1}(t) - \nu^x_j(t)) \right]$. The quantity $\nu^x_j$
describes the fraction of sites which are connected to node $x$ that are in state $j$ and thus also satisfies
$\nu^x_1+\nu^x_2+\nu^x_3=1$.

In the continuous limit, the average values of $\nu$ will dictate the dynamics. This average is taken over independent realizations of
the dynamics on different graphs produced by the rewiring process. We define the average value of $\nu$ as

\begin{align}
    \left< \nu^x_j(t) \right> = \frac{\left< n^x_j(t) \right>}{\left< n^x(t) \right>}
    \label{nuMF}
\end{align}

\noindent where the average is taken over independent realizations and \textit{not} over time. With this definition we can write the
mean field transition rates

\begin{align}
    \left< \gamma^x_j \right> = g^x \exp \left[ a \left( \left< \nu^x_{j+1} \right> - \left< \nu^x_j \right> \right) \right]
    \label{gammaMF}
\end{align}

\noindent where we have omitted the explicit time dependence. The equations of motion \ref{eqmotion} for the probabilities in the MF
become

\begin{align}
    \ddt{p^x_1} &= \left< \gamma^x_3 \right> (1-p^x_1-p^x_1) - \left< \gamma^x_1 \right> p^x_1 \notag \\
    \ddt{p^x_2} &= \left< \gamma^x_1 \right>  p^x_1 - \left< \gamma^x_2 \right> p^x_2
    \label{eqmotionMF}
\end{align}

We see that in order to have any hope of solving the set of equations~(\ref{nuMF})~to~(\ref{eqmotionMF}) we must be able to calculate
the averages of the random variables $n^x$ and $n^x_j$.

To do that, we define the dummy variable $D_{xx'}$, which indicates the presence (or absence) of a connection between nodes $x$ and
$x'$ in a graph. With this notation we can write the exact expressions for $n^x$ and $n^x_j$ in the discrete case. Let $D_{xx'}$ be
defined as

\begin{align}
    D_{xx'} = 
    \begin{cases}
        1 \qquad &\text{if the connection $x$,$x'$ exists}\\
        0 \qquad &\text{otherwise}
    \end{cases}
\end{align}

\noindent then, if the states of sites $x,x'$ are $j,j'$ respectively, we have:

\begin{align}
    n^x_j &= \sum\limits_{x'=1}^ND_{xx'}\delta_{jj'}(t) \notag\\[8pt]
    n^x &= \sum\limits_{x'=1}^ND_{xx'}
\end{align}

\noindent where $\delta_{jj'}$ is the usual Kronecker delta defined by $\delta_{jj'}=\begin{cases}1 \quad j=j'\\0 \quad j\neq
j'\end{cases}$, and thus $\left< \nu^x_j(t) \right>$ becomes

\begin{align}
    \left< \nu^x_j(t) \right> &= \frac{\sum\limits_{x'=1}^N\left< D_{xx'}\delta_{jj'}(t)\right>}{\sum\limits_{x'=1}^N\left< D_{xx'} \right>}
    \notag \\[8pt]
    \left< \nu^x_j(t) \right> &= \frac{\sum\limits_{x'=1}^N\left< D_{xx'}\right>\left<\delta_{jj'}(t)\right>}{\sum\limits_{x'=1}^N\left< D_{xx'} \right>}
\end{align}

\noindent In order to solve the proposed MF we assume $\left< D_{xx'}\delta_{jj'}(t)\right> = \left<
D_{xx'}\right>\left<\delta_{jj'}(t)\right>$. In words this means the state of site $x'$ depends on the state of site $x$ regardless of
them being coupled or not. This is more accurate when the probability of rewiring $p$ is approximately zero, which is true for a large
number of networks in the small-world regime, as seen in figure~\ref{fig:small-world} of chapter~\ref{chap:article}. When $p=0$ we can
restrict the summation over the connected sites and recover the MF proposed by Escaff \textit{et al.}~\cite{escaff2014arrays}, making
$\delta_{jj'}$ truly independent from $D_{xx'}$.

The quantity $\left< \delta_{jj'}(t) \right>$ can be identified with the probability of finding the site at $x'$ in state $j$ at time
$t$, which we write as $P^{x'}_j(t)$. This probability is the central point of the mean-field

\begin{align}
    \left< \frac{D_{xx'}}{\sum_{x''=1}^ND_{xx''}}\delta_{jj'} \right> &= \left< \frac{D_{xx'}}{\sum_{x''=1}^ND_{xx''}} \right>\left< \delta_{jj'} \right> \notag\\[8pt]
    &= \left< \frac{D_{xx'}}{\sum_{x''=1}^ND_{xx''}} \right> P^{x'}_j
\end{align}
